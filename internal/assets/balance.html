<!DOCTYPE html>
<html lang="en">
<head>
    <title>Wallet Balance - Launchpad</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Apple-style custom styles */
        .glass-effect {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        .balance-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
            border: 1px solid rgba(255,255,255,0.3);
        }
        .token-address {
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
        }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-50 min-h-screen">
    <!-- Background Pattern -->
    <div class="fixed inset-0 opacity-5">
        <div class="absolute inset-0" style="background-image: radial-gradient(circle at 50% 50%, rgba(59, 130, 246, 0.1) 0%, transparent 50%)"></div>
    </div>
    
    <!-- Main Container -->
    <div class="relative z-10 min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-3xl">
            <!-- Logo/Brand Area -->
            <div class="text-center mb-8 fade-in">
                <div class="w-16 h-16 mx-auto bg-gradient-to-r from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center mb-4 shadow-lg">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h1 class="text-2xl font-semibold text-gray-900 mb-1">Wallet Balance</h1>
                <p class="text-gray-600 text-sm">View your token balances</p>
            </div>
            
            <!-- Main Content Card -->
            <div class="bg-white/80 glass-effect border border-gray-200/50 rounded-3xl shadow-xl fade-in">
                <div id="session-data" data-session-id="{{.SessionID}}" data-api-url="/api/balance/{{.SessionID}}"></div>
                <div id="content" class="p-6">
                    <!-- Loading State -->
                    <div class="text-center py-8">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mb-4"></div>
                        <p class="text-gray-600">Loading balance details...</p>
                    </div>
                </div>

                
                <!-- Balance Display (Initially Hidden) -->
                <div id="balance-info" class="hidden p-6">
                    <!-- Connected Wallet Info -->
                    <div class="mb-6 p-4 bg-gray-50 rounded-2xl">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Connected Wallet</p>
                                <code id="wallet-address" class="token-address text-gray-900 text-sm">Loading...</code>
                            </div>
                            <button onclick="copyWalletAddress()" class="px-3 py-1 text-sm text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-all">
                                Copy
                            </button>
                        </div>
                    </div>

                    <!-- Native Balance Card -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-3">Native Balance</h3>
                        <div class="bg-white border border-gray-200 rounded-2xl p-6 shadow-sm">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="flex items-center mb-2">
                                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <p id="native-symbol" class="font-semibold text-gray-900">ETH</p>
                                            <p class="text-sm text-gray-600">Native Token</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p id="native-balance" class="text-2xl font-bold text-gray-900">--.-- ETH</p>
                                    <p id="native-balance-wei" class="text-sm text-gray-500">0 wei</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Token Balance Card (if token address provided) -->
                    <div id="token-balance-section" class="hidden mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-3">Token Balance</h3>
                        <div class="bg-white border border-gray-200 rounded-2xl p-6 shadow-sm">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="flex items-center mb-2">
                                        <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                            <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <p id="token-symbol" class="font-semibold text-gray-900">TOKEN</p>
                                            <div class="text-sm text-gray-600">
                                                <code id="token-address-display" class="token-address">Loading...</code>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p id="token-balance" class="text-2xl font-bold text-gray-900">--.-- TOKEN</p>
                                    <p id="token-balance-raw" class="text-sm text-gray-500">0 raw</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Refresh Button -->
                    <div class="text-center">
                        <button id="refresh-balance" onclick="refreshBalance()" class="px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-all duration-200">
                            <div class="flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                Refresh Balances
                            </div>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="text-center mt-6 text-xs text-gray-500">
                Powered by Web3 â€¢ Real-time Balance Updates
            </div>
        </div>
    </div>
    
    <script>
        // Copy wallet address function
        function copyWalletAddress() {
            const addressElement = document.getElementById('wallet-address');
            if (addressElement && addressElement.textContent !== 'Loading...') {
                navigator.clipboard.writeText(addressElement.textContent).then(() => {
                    // Show feedback
                    const button = event.currentTarget;
                    const originalText = button.textContent;
                    button.textContent = 'Copied!';
                    setTimeout(() => {
                        button.textContent = originalText;
                    }, 2000);
                });
            }
        }

        // Refresh balance function  
        function refreshBalance() {
            const button = document.getElementById('refresh-balance');
            if (button) {
                const originalHTML = button.innerHTML;
                button.innerHTML = '<div class="flex items-center"><div class="w-4 h-4 mr-2 animate-spin rounded-full border-2 border-gray-400 border-t-transparent"></div>Refreshing...</div>';
                button.disabled = true;
                
                // Reload the page to refresh balance data
                setTimeout(() => {
                    location.reload();
                }, 1000);
            }
        }

        // Update balance display (called by wallet.js)
        function updateBalance(balanceData) {
            if (balanceData.native_balance) {
                document.getElementById('native-symbol').textContent = balanceData.native_balance.native_symbol || 'ETH';
                document.getElementById('native-balance').textContent = balanceData.native_balance.formatted_balance || '0 ETH';
                document.getElementById('native-balance-wei').textContent = balanceData.native_balance.native_balance + ' wei';
            }

            if (balanceData.token_balance) {
                document.getElementById('token-balance-section').classList.remove('hidden');
                document.getElementById('token-symbol').textContent = balanceData.token_balance.token_symbol || 'TOKEN';
                document.getElementById('token-address-display').textContent = balanceData.token_balance.token_address || '';
                document.getElementById('token-balance').textContent = balanceData.token_balance.formatted_balance || '0 TOKEN';
                document.getElementById('token-balance-raw').textContent = balanceData.token_balance.token_balance + ' raw';
            }

            if (balanceData.wallet_address) {
                document.getElementById('wallet-address').textContent = balanceData.wallet_address;
            }
            
            // Show balance section and hide content
            const content = document.getElementById('content');
            const balanceInfo = document.getElementById('balance-info');
            if (content) content.style.display = 'none';
            if (balanceInfo) balanceInfo.classList.remove('hidden');
        }
    </script>
    <script src="/js/wallet-connection.js"></script>
    <script src="/js/balance-query.js"></script>
</body>
</html>